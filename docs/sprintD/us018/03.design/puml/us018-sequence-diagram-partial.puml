@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

'hide footbox
actor "Store Manager" as ADM
participant ":AnalyzeDealsUI" as UI
participant ":AnalyzeDealsController" as CTRL
participant ":Repositories" as RepositorySingleton
participant "repositories\n:Repositories" as PLAT
participant "regressionModelTypeRepository\n:RegressionModelTypeRepository" as RMTRep
participant "agencyRepository\n:AgencyRepository" as AgencyRepository
participant ":RegressionModel" as RM
participant "independentVariablesRepository\n:IndependentVariablesRepository" as IVRep
participant "regressionModelTypeMapper\n:RegressionModelTypeMapper" as RMTMapper
participant "regressionModelTypeDto\n:RegressionModelTypeDto" as RMTDto
participant "regressionModelTypeDtoList\n:List<RegressionModelTypeDto>" as RMTDtoList
participant "regressionModelType\n:RegressionModelType" as RMT



activate ADM

    ADM -> UI : asks to analyze property deals.
    activate UI

    UI -> CTRL**: create()

    UI -> CTRL : getRegressionModelTypeList()
    activate CTRL

    CTRL -> RepositorySingleton : getInstance()
    activate RepositorySingleton

        RepositorySingleton --> CTRL: repositories
    deactivate RepositorySingleton

    CTRL -> PLAT : getRegressionModelTypeRepository()
    activate PLAT

        PLAT --> CTRL: RegressionModelTypeRepository
    deactivate PLAT

    CTRL -> RMTRep : getRegressionModelTypeList()
    activate RMTRep

    RMTRep --> CTRL : regressionModelTypeList
    deactivate RMTRep

    CTRL -> RMTMapper: toDto(regressionModelTypeList)
    activate RMTMapper

    RMTMapper -> RMTDtoList** : create()

    loop for each regressionModelType

    RMTMapper -> RMTMapper : toDto(regressionModelType)
    activate RMTMapper

    RMTMapper -> RMT : getRegressionModelTypeDesignation()
    activate RMT

    RMT --> RMTMapper : regressionModelTypeDesignation
    deactivate RMT

    |||
    RMTMapper -> RMTDto** : create(regressionModelTypeDesignation)


    RMTMapper --> RMTMapper: regressionModelTypeDto
    deactivate RMTMapper
    |||
    RMTMapper -> RMTDtoList: add(regressionModelTypeDto)
    activate RMTDtoList
    deactivate RMTDtoList
    end loop

    RMTMapper --> CTRL : regressionModelTypeDtoList
    deactivate RMTMapper

    CTRL --> UI: regressionModelTypeDtoList
    deactivate CTRL


    UI --> ADM : shows regression models available \nand asks to select one.
    deactivate UI

    ADM -> UI : selects regression model.
    activate UI

    alt regressionModelTypeDto == simple linear
        UI --> ADM: shows the parameters available for regression \nmodels and asks to select one.
         deactivate UI
        ADM -> UI: selects parameter.
        activate UI
        |||
    end alt

    UI -> CTRL : getRegressionModelStatisticsAndForecastValues(regressionModelTypeDto, parameter)
    activate CTRL

    CTRL -> RMTMapper : toModel(regressionModelTypeDto)
    activate RMTMapper

    RMTMapper -> RMTDto : getRegressionModelTypeDesignation()
    activate RMTDto

    RMTDto --> RMTMapper : regressionModelTypeDesignation
    deactivate RMTDto

    RMTMapper -> RMT** : create(regressionModelTypeDesignation)

    RMTMapper --> CTRL : regressionModelType
    deactivate RMTMapper


    |||
    CTRL -> CTRL : getDataForAnalysis(parameter)
    activate CTRL

    CTRL -> PLAT : getAgencyRepository()
    activate PLAT

    PLAT --> CTRL : agencyRepository
    deactivate PLAT

    alt regressionModelType == simple linear

    CTRL -> AgencyRepository : getAgenciesAnnouncementDataListForSLR(parameter)
    activate AgencyRepository
        ref over AgencyRepository
         Get all data for SLR analysis
        end ref

    AgencyRepository --> CTRL  : allDataList
    deactivate AgencyRepository


    |||

    else regressionModelType == simple linear

            CTRL -> AgencyRepository : getAgenciesAnnouncementDataListForMLR()
            activate AgencyRepository
                ref over AgencyRepository
                 Get all data for MLR analysis
                end ref

            AgencyRepository --> CTRL  : allDataList
            deactivate AgencyRepository


    |||
    end alt

    CTRL --> CTRL: allDataList
    deactivate CTRL



    CTRL -> RM  : getRegressionModelStatistics(allDataList)
    activate RM

        note right RM
            RegressionModel implementation will
            depend on the regressionModelType
        end note


    RM --> CTRL: statistics
    deactivate RM

    note right CTRL
        VER MELHOR COMO FAZER ESTE GET
        NO FINAL PRETENDE-SE QUE POSSA IR BUSCAR:
            SLOPE
            INTERCEPT
    end note


    CTRL --> UI : regressionModelStatistics
    deactivate CTRL

    UI --> ADM : shows the estimated price for each house\nand apartment deal, and the selected \nregression model report.
    deactivate UI


deactivate ADM

@enduml