@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

'hide footbox
actor "Unregistered User" as User
participant ":DisplayPropertiesUI" as UI
participant ":DisplayPropertiesController" as CTRL
participant ":Repositories" as RepositorySingleton
participant "repositories\n:Repositories" as PLAT
participant "filtersRepository\n:FiltersRepository" as FILTERSREP
participant "agencyRepository\n: AgencyRepository" as AGENCYREP
participant "agency\n: Agency" as AGENCY


activate User

    User -> UI : asks to display listed properties
    activate UI

    UI -> CTRL** : create

    UI -> CTRL : getAnnouncements()
    activate CTRL

         CTRL -> RepositorySingleton : getInstance()
         activate RepositorySingleton

         RepositorySingleton --> CTRL: repositories
         deactivate RepositorySingleton

         CTRL -> PLAT : getAgencyRepository()
         activate PLAT

         PLAT --> CTRL : agencyRepository
         deactivate PLAT

         loop for each agency

         CTRL -> AGENCYREP : getAgency()
         activate AGENCYREP

         AGENCYREP --> CTRL : agency
         deactivate AGENCYREP

         CTRL -> AGENCY : getAnnouncementList()
         activate AGENCY

         AGENCY --> CTRL : announcementList
         deactivate AGENCY

         end
        'CTRL -> CTRL : keepAnnouncements

'        CTRL -> ANNOUNCREP : getAcceptancesDates(announcementList))
'        activate ANNOUNCREP
'
'        ANNOUNCREP --> CTRL : acceptancesDatesList
'        deactivate ANNOUNCREP

         CTRL -> CTRL : sortByMostRecentAdded(announcementList)
         activate CTRL
         deactivate CTRL

         CTRL -> CTRL : announcementList
         activate CTRL
         deactivate CTRL

         CTRL --> UI : announcementList
         deactivate CTRL

         UI -> CTRL : getFiltersList()
         activate CTRL

             'CTRL -> FILTERS : getFilters()
             'activate FILTERS

             CTRL -> RepositorySingleton : getInstance()
             activate RepositorySingleton

             RepositorySingleton --> CTRL: repositories
             deactivate RepositorySingleton

             CTRL -> PLAT : getFiltersRepository()
             activate PLAT

             PLAT --> CTRL: filtersRepository
             deactivate PLAT

             CTRL -> FILTERSREP : getFiltersList()
             activate FILTERSREP

             FILTERSREP --> CTRL : filtersList
             deactivate FILTERSREP

         CTRL --> UI : filtersList
         deactivate CTRL

    UI --> User : display listed properties by most recent added


    opt type of business
        UI --> User : shows types of business and asks to select one
        deactivate UI

        User -> UI : selects data (businessType)
        activate UI

        UI -> CTRL :  getAnnouncements(announcements, businessType)
        activate CTRL

        CTRL -> AGENCYREP : getAnnouncements(announcements, businessType)
        activate AGENCYREP

        AGENCYREP -> AGENCY : getAnnouncementsByBusinessType(announcementList,\n businessType)
        activate AGENCY

        loop for each announcement

            AGENCY -> AGENCY : announcementHasBusinessType(announcementList,\n businessType)
            activate AGENCY

            AGENCY --> AGENCY: true/false
            deactivate AGENCY

            alt false
            AGENCY -> AGENCY : removeAnnouncement(announcementList)
            activate AGENCY

            AGENCY --> AGENCY: announcementList
            deactivate AGENCY
            |||
           end
        |||
        end

        AGENCY --> AGENCYREP : announcementList
        deactivate AGENCY

        AGENCYREP --> CTRL : announcementList
        deactivate AGENCYREP

        CTRL --> UI : announcementList
        deactivate CTRL

        UI --> User : display all the listed properties, according to the \ncriteria chosen
            |||
    end

    opt type of property
        UI --> User : shows types of properties and asks to select one
        deactivate UI

        User -> UI : selects data (propertyType)
        activate UI

    UI -> CTRL :  getAnnouncements(announcements, propertyType)
    activate CTRL

    CTRL -> AGENCYREP : getAnnouncements(announcements, propertyType)
    activate AGENCYREP

    AGENCYREP -> AGENCY : getAnnouncementsByPropertyType(announcementList,\n propertyType)
    activate AGENCY

    loop for each announcement
        AGENCY -> AGENCY : announcementHasPropertyType(announcementList,\n propertyType)
        activate AGENCY

        AGENCY --> AGENCY: true/false
        deactivate AGENCY

        alt false
            AGENCY -> AGENCY : removeAnnouncement(announcementList)
            activate AGENCY

            AGENCY --> AGENCY: announcementList
            deactivate AGENCY
        |||
        end
        |||
    end

        AGENCY --> AGENCYREP : announcementList
        deactivate AGENCY

        AGENCYREP --> CTRL : announcementList
        deactivate AGENCYREP

        CTRL --> UI : announcementList
        deactivate CTRL

        UI --> User : display all the listed properties, according to the \ncriteria chosen

        |||
    end

    alt propertyType != land
    |||
    opt number of bedrooms

        UI --> User : shows options for number of bedrooms and asks to select one
        deactivate UI

        User -> UI : selects data (numberBedrooms)
        activate UI

        UI -> CTRL :  getAnnouncements(announcements, numberBedrooms)
        activate CTRL

        CTRL -> AGENCYREP : getAnnouncements(announcements, numberBedrooms)
        activate AGENCYREP

        AGENCYREP -> AGENCY : getAnnouncementsByNumberBedrooms(announcementList,\n numberBedrooms)
        activate AGENCY

        loop for each announcement
            AGENCY -> AGENCY : announcementHasNumberBedrooms(announcementList,\n numberBedrooms)
            activate AGENCY

            AGENCY --> AGENCY: true/false
            deactivate AGENCY

            alt false
            AGENCY -> AGENCY : removeAnnouncement(announcementList)
            activate AGENCY

            AGENCY --> AGENCY: announcementList
            deactivate AGENCY
        |||
        end
    |||
    end

    AGENCY --> AGENCYREP : announcementList
    deactivate AGENCY

    AGENCYREP --> CTRL : announcementList
    deactivate AGENCYREP

    CTRL --> UI : announcementList
    deactivate CTRL

    UI --> User : display all the listed properties, according to the \ncriteria chosen

    |||
    end
    |||
    end

    UI -> UI : sortingList
    activate UI

    UI --> UI
    deactivate UI



    opt price
        UI --> User : shows options for sort properties by price and asks to select one
        deactivate UI

        User -> UI : select data (sortingType)
        activate UI

        UI -> CTRL : sortAnnouncements(price, sortingType, announcementList)
        activate CTRL

        CTRL -> AGENCYREP : sortAnnouncements(price, sortingType, announcementList)
        activate AGENCYREP

        AGENCYREP -> AGENCY : sortAnnouncements(price, sortingType, announcementList)
        activate AGENCY

        alt ascending price

            AGENCY -> AGENCY : sortAnnouncementsByAscendingPrice(announcementList)
            activate AGENCY

            AGENCY --> AGENCY : announcementList
            deactivate AGENCY

            else descending price

            AGENCY -> AGENCY : sortAnnouncementsByDescendingPrice(announcementList)
            activate AGENCY

            AGENCY --> AGENCY : announcementList
            deactivate AGENCY

            |||
        end

        AGENCY --> AGENCYREP : announcementList
        deactivate AGENCY

        AGENCYREP --> CTRL : announcementList
        deactivate AGENCYREP

        CTRL --> UI : announcementList
        deactivate CTRL

        UI --> User : display all the listed properties, according to the \ncriteria chosen

    |||
    end

    opt city
        UI --> User : shows options for sort properties by city and asks to select one
        deactivate UI

        User -> UI : select data (sortingType)
        activate UI

        UI -> CTRL : sortAnnouncements(city, sortingType, announcementList)
        activate CTRL

        CTRL -> AGENCYREP : sortAnnouncements(city, sortingType, announcementList)
        activate AGENCYREP

        AGENCYREP -> AGENCY : sortAnnouncements(city, sortingType, announcementList)
        activate AGENCY

        alt ascending city

            AGENCY -> AGENCY : sortAnnouncementsByAscendingCity(announcementList)
            activate AGENCY

            AGENCY --> AGENCY : announcementList
            deactivate AGENCY

            else descending city

            AGENCY -> AGENCY : sortAnnouncementsByDescendingCity(announcementList)
            activate AGENCY

            AGENCY --> AGENCY : announcementList
            deactivate AGENCY

        |||
        end

       AGENCY --> AGENCYREP : announcementList
       deactivate AGENCY

       AGENCYREP --> CTRL : announcementList
       deactivate AGENCYREP

       CTRL --> UI : announcementList
       deactivate CTRL

       UI --> User : display all the listed properties, according to the \ncriteria chosen

    |||
    end

    opt state
        UI --> User :  shows options for sort properties by state and asks to select one
        deactivate UI

        User -> UI : select data (sortingType)
        activate UI

        UI -> CTRL : sortAnnouncements(state, sortingType, announcementList)
        activate CTRL

        CTRL -> AGENCYREP : sortAnnouncements(state, sortingType, announcementList)
        activate AGENCYREP

        AGENCYREP -> AGENCY : sortAnnouncements(state, sortingType, announcementList)
        activate AGENCY

        alt ascending state

            AGENCY -> AGENCY : sortAnnouncementsByAscendingState(announcementList)
            activate AGENCY

            AGENCY --> AGENCY : announcementList
            deactivate AGENCY

            else descending state

            AGENCY -> AGENCY : sortAnnouncementsByDescendingState(announcementList)
            activate AGENCY

            AGENCY --> AGENCY : announcementList
            deactivate AGENCY

        |||
        end

        AGENCY --> AGENCYREP : announcementList
        deactivate AGENCY

        AGENCYREP --> CTRL : announcementList
        deactivate AGENCYREP

        CTRL --> UI : announcementList
        deactivate CTRL

        UI --> User : display all the listed properties, according to the \ncriteria chosen
        deactivate UI
    |||
    end


deactivate User

@enduml