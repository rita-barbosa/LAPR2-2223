@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

'hide footbox
actor "Agent" as ADM
participant ":ListRequestsUI" as UI
participant ":ListRequestsController" as CTRL
participant ":Repositories" as RepositorySingleton
participant "repositories\n:Repositories" as PLAT
participant "agencyRepository:\nAgencyRepository" as AgencyRepository
participant "agency\n: Agency" as AGENCY
 participant "commissionTypeRepository\n:CommissionTypeRepository" as CommissionTypeRepository
'participant ":ApplicationSession" as _APP
'participant "appSession\n:ApplicationSession" as APP
'participant "currentSession\n:UserSession" as SESSAO
'participant "organizationRepository:\nOrganizationRepository" as OrganizationRepository
'participant "organization\n:Organization" as ORG
'participant "task\n:Task" as TAREFA

activate ADM

        ADM -> UI : asks to display the requests made to himself

        activate UI

'            UI --> ADM : requests data (reference, description,  informal \n description, technical description, duration, cost)
            'create CTRL
            UI -> CTRL** : create

            UI -> CTRL : getRequestList(id)
            activate CTRL

                CTRL -> RepositorySingleton : getInstance()
                activate RepositorySingleton

                    RepositorySingleton --> CTRL: repositories
                deactivate RepositorySingleton

                CTRL -> PLAT : getAgencyRepository()
                activate PLAT

                    PLAT --> CTRL: agencyRepository
                deactivate PLAT

                CTRL -> AgencyRepository : getAgency(id)
                activate AgencyRepository

                    AgencyRepository --> CTRL : agency
                deactivate AgencyRepository

                CTRL -> AGENCY : get requestList()
                activate AGENCY

                AGENCY --> CTRL : requestList
                deactivate AGENCY

                CTRL --> UI : requestList
            deactivate CTRL

            UI --> ADM : shows the list of requests
        deactivate UI

    loop for the requests of the agent

    ADM -> UI : asks to make a decision for the request
    activate UI



        UI --> ADM : shows the request and asks data (option)
    deactivate UI

    ADM -> UI : submits data (option)
    activate UI

    alt option == accept

          UI -> CTRL : getComissionTypeLis()
          activate CTRL

                            CTRL -> RepositorySingleton : getInstance()
                            activate RepositorySingleton

                                RepositorySingleton --> CTRL: repositories
                            deactivate RepositorySingleton

                            CTRL -> PLAT : getCommissionTypeRepository()
                            activate PLAT

                                PLAT --> CTRL: commissionTypeRepository
                            deactivate PLAT

                            CTRL -> CommissionTypeRepository : getCommissionTypeList()
                            activate CommissionTypeRepository

                            CommissionTypeRepository --> CTRL : commissionTypeList
                            deactivate CommissionTypeRepository



              CTRL --> UI : commissionTypeList
              deactivate CTRL

            UI --> ADM : shows types of commission and asks to select one
            deactivate UI

            ADM -> UI : selects type of commission
            activate UI

            UI --> ADM : requests value of commission
            deactivate UI

            ADM -> UI : enters commission value
            activate UI

            UI --> ADM : shows all data and asks to submits
            deactivate UI

            ADM -> UI : submits data
            activate UI

            UI -> CTRL : publishAnnouncement(commissionValue, commissionTypeDesignation, ownerEmail, propertyTypeDesignation,\nstreetName, city, district, state, zipCode, area, distanceCityCenter,\nprice,numberBedroom,numberParkingSpace,\nexistenceBasement,inhabitableLoft, numberBathroom, availableEquipmentDescriptionList, uriList, sunExposure)
            activate CTRL

            CTRL -> CTRL : getEmailFromSession()

                ref over CTRL
                    Get Email
                end ref

                activate CTRL

            CTRL --> CTRL : email
            deactivate CTRL
            |||
            CTRL -> CTRL : getAgencyByEmail(email)

                ref over CTRL
                    Get Agency
                end ref

                activate CTRL

            CTRL --> CTRL : agency
            deactivate CTRL
            |||
            CTRL -> AGENCY: getAgentByEmail(email, agency)
            activate AGENCY

            AGENCY --> CTRL : agent
            deactivate AGENCY

            |||
            CTRL-> CTRL : getPropertyTypeByDescription(propertyTypeDesignation)
                activate CTRL
                    ref over CTRL
                    Get Property Type Object
                    end ref
                CTRL -->  CTRL: propertyType
                deactivate CTRL
            |||
            CTRL -> CTRL : getCommissionTypeByDescription(commissionTypeDesignation)
                activate CTRL
                    ref over CTRL
                    Get Commission Type Object
                    end ref
                CTRL --> CTRL : commissionType
                deactivate CTRL
            |||
            CTRL -> AGENCY : createSaleRequest( ownerEmail, propertyType,\nstreetName, city, district, state, zipCode, area, distanceCityCenter,\nprice,businessType,numberBedroom,numberParkingSpace,\nexistenceBasement,inhabitableLoft, numberBathroom, availableEquipmentDescriptionList,uriList, sunExposure)
            activate AGENCY

            ref over AGENCY
            Create Request
            end ref

            AGENCY -->CTRL : request

            deactivate AGENCY

                |||
                CTRL -> AGENCY: publishAnnouncement(agent, commissionType, commissionValue, request)

                    ref over AGENCY
                        Publish Announcement
                    end ref

                    activate AGENCY

                AGENCY --> CTRL: announcement
                deactivate AGENCY

                CTRL --> UI: announcement
                deactivate CTRL

    else option == decline

            UI --> ADM : asks for justification message
            deactivate UI

            ADM -> UI : submits message
            activate UI

            UI -> CTRL : getOwnerEmail()
            activate CTRL

            note right CTRL
            **check other us's**
            end note

            CTRL --> UI : ownerEmail
            deactivate CTRL

    end

    UI --> ADM : shows operation success and shows the list of requests
    deactivate UI


'        UI --> ADM : shows selected category and requested data
'    deactivate UI
'
'    ADM -> UI : submits data
'    activate UI
'
'        UI -> CTRL : createTask(reference,\ndescription,\ninformalDescription,\ntechnicalDescription,\nduration, cost,\ntaskCategoryDescription)
'        activate CTRL
'
'            CTRL -> CTRL : getTaskCategoryByDescription(taskCategoryDescription)
'            activate CTRL
'
'                CTRL -> RepositorySingleton : getInstance()
'                activate RepositorySingleton
'
'                    RepositorySingleton --> CTRL: repositories
'                deactivate RepositorySingleton
'
'                CTRL -> PLAT : getTaskCategoryRepository()
'                activate PLAT
'
'                    PLAT -> CTRL : taskCategoryRepository
'                deactivate PLAT
'
'                CTRL -> TaskCategoryRepository : getTaskCategoryByDescription(taskCategoryDescription)
'                activate TaskCategoryRepository
'
'                    TaskCategoryRepository --> CTRL : taskCategory
'                deactivate TaskCategoryRepository
'                    CTRL --> CTRL : taskCategory
'            deactivate CTRL
'
'            |||
'            CTRL -> CTRL : getEmployeeFromSession()
'            activate CTRL
'
'                CTRL -> _APP: getInstance()
'                activate _APP
'                    _APP -> CTRL: appSession
'                deactivate _APP
'
'
'                CTRL -> APP: getCurrentSession()
'                activate APP
'
'                    APP --> CTRL: currentSession
'                deactivate APP
'
'                CTRL -> SESSAO: email = getUserEmail()
'                activate SESSAO
'
'                    SESSAO --> CTRL: email
'                deactivate SESSAO
'
'
'                CTRL -> PLAT: getOrganizationRepository(email)
'                activate PLAT
'
'                    PLAT --> CTRL: organizationRepository
'                deactivate PLAT
'
'
'                CTRL -> OrganizationRepository: getOrganizationByEmployeeEmail(email)
'                activate OrganizationRepository
'
'                    loop [for each organization
'                        OrganizationRepository -> ORG : anyEmployeeHasEmail(email)
'                        activate ORG
'
'                             ORG --> OrganizationRepository : true/false
'                        deactivate ORG
'                    end
'                    OrganizationRepository --> CTRL : organization
'                deactivate OrganizationRepository
'
'                CTRL -> ORG: getEmployeeByEmail(email)
'                activate ORG
'
'                    ORG --> CTRL : employee
'                deactivate ORG
'
'                CTRL --> CTRL : employee
'            deactivate CTRL
'
'            |||
'            CTRL -> ORG: createTask(employee, reference, description,\ninformalDescription, technicalDescription,\nduration, cost, , taskCategory, employee)
'            activate ORG
'
'                ORG -> TAREFA**: create(employee, reference, description,\ninformalDescription, technicalDescription,\nduration, cost, taskCategory, employee)
'                ORG -> ORG: addTask (task)
'
'
'                activate ORG
'                    ORG -> ORG: validateTask(task)
'                    activate ORG
'                        ORG --> ORG
'                    deactivate ORG
'
'                    ORG --> ORG
'                deactivate ORG
'
'                ORG --> CTRL : task
'
'            deactivate ORG
'
'            CTRL --> UI: task
'            deactivate CTRL
'            UI --> ADM: displays operation success
'    deactivate UI

deactivate ADM

end

@enduml