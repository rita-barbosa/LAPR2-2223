@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false


participant "announcement\n: Announcement" as Announce
participant "orderList\n: OrderList" as OrderList
participant "orderMapper\n: OrderMapper" as OrderMapper
participant "orderDto\n: OrderDto" as OrderDTO
participant "order\n: Order" as Order


autonumber 30
    -> Announce : defineOrderAcceptance(answer,orderDto)
    activate Announce

group Define Acceptance of Order
autonumber 30.1
    Announce -> OrderMapper: toModel(orderDto)
    activate OrderMapper

    OrderMapper -> OrderDTO : orderAmount = getOrderAmount()
    activate OrderDTO
    deactivate OrderDTO

    OrderMapper -> OrderDTO : orderDate = getOrderDate()
    activate OrderDTO
    deactivate OrderDTO

    OrderMapper -> OrderDTO : clientEmail = getClientEmail()
    activate OrderDTO
    deactivate OrderDTO

    OrderMapper -> Order** : create(orderAmount, orderDate, clientEmail)

    OrderMapper --> Announce : order
    deactivate OrderMapper

    Announce -> OrderList : defineOrderAcceptance(answer, order)
    activate OrderList

    OrderList -> Order : setAcceptanceAnswer(answer)
    activate Order

    Order -> Notification: sendOrderAcceptanceNotification(clientEmail, answer)
    activate Notification
    Notification --> Order : success
    deactivate Notification

    deactivate Order
        alt answer == accept

            loop for all the other orders

            OrderList -> Order : rejectOrder()
            activate Order

            alt acceptanceAnswer != null
            Order -> Order : setAcceptanceAnswer(answer)
            activate Order

            Order -> Notification: sendOrderAcceptanceNotification(clientEmail,answer)
            activate Notification
            deactivate Notification

            Order --> Order:
            deactivate Order
             |||
            end alt
            deactivate Order
            |||
            end loop

        end alt
    OrderList --> Announce: success
    deactivate OrderList

end group

autonumber 31
    <-- Announce: success
    deactivate Announce




@enduml