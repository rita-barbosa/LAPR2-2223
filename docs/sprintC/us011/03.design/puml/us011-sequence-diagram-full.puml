@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

'hide footbox
actor "Agent" as ADM
participant ":AcceptOrdersUI" as UI
participant ":AcceptOrdersController" as CTRL
participant ":Repositories" as RepositorySingleton
participant "repositories\n:Repositories" as PLAT
participant "agencyRepository\n: AgencyRepository" as AgRep
participant "agency\n: Agency" as AGENCY
participant "announcementList\n: AnnouncementList" as AnnList
participant "announcementMapper\n: AnnouncementMapper" as AnnMAPPER
participant "announcementDto\n: AnnouncementDto" as AnnDTO

activate ADM
    ADM -> UI : asks to accept purchase orders
    activate UI

    UI -> CTRL** : create

    UI -> CTRL : getAnnouncementList()
    activate CTRL

    CTRL -> RepositorySingleton : getInstance()
    activate RepositorySingleton

    RepositorySingleton --> CTRL : repositories
    deactivate RepositorySingleton

     CTRL -> PLAT :  getAgencyRepository()
     activate PLAT

     PLAT -> CTRL : agencyRepository
     deactivate PLAT

     CTRL-> AgRep : getAgenciesList()
     activate AgRep

     AgRep --> CTRL : agenciesList()
     deactivate AgRep

     loop for all agencies
     CTRL -> AGENCY :  getAnnouncementList()
     activate AGENCY

     AGENCY -> AnnList : getAnnouncementList()
     activate AnnList

     AnnList --> AGENCY: announcementList
     deactivate AnnList

     AGENCY --> CTRL: announcementList
     deactivate AGENCY

     CTRL -> AnnMAPPER : toDTO(announcementList)
     activate AnnMAPPER

     loop for each announcement

     AnnMAPPER -> AnnMAPPER : toDTO(announcement)
     activate AnnMAPPER

     AnnMAPPER -> AnnDTO**: create(announcement)
    deactivate AnnMAPPER


     AnnMAPPER -> AnnMAPPER: add(announcementDto)
     activate AnnMAPPER
     AnnMAPPER --> AnnMAPPER:
     deactivate AnnMAPPER
     |||
     end loop

     AnnMAPPER --> CTRL : announcementDtoList
     deactivate AnnMAPPER

     end loop

    CTRL --> UI: announcementDtoList
    deactivate CTRL








    loop for all properties available for purchase

    UI --> ADM : displays properties available for purchase \nand asks to select one
    deactivate UI

    ADM -> UI : selects property
    activate UI

    UI -> CTRL: getPurchaseOrderList(announcementDto)
    activate CTRL

    CTRL -> AnnDTO : orderDtoList = getPurchaseOrderList()
    activate AnnDTO




    CTRL --> UI: orderDtoList
    deactivate CTRL

    loop while acceptanceAnswer != yes \n&& purchaseOrderList != empty

    UI -->  ADM: displays purchase order and asks the acceptance answer
    deactivate UI

    ADM -> UI  : selects acceptance answer
    activate UI

    UI -> CTRL : defineOrderAcceptance(answer,orderDto,announcementDto)
    activate CTRL
        note right CTRL
        O QUE FALTA -->  ** TENHO DÚVIDAS**:
            * Adicionar a accpetanceAnswer às orders do anuncio
            * Fazer o sendNotification()

        end note
    CTRL --> UI : operationSuccess
    deactivate CTRL

    UI --> ADM : displays operation success
    deactivate UI

    end loop
    end loop

    deactivate ADM



@enduml